import{u as B,f as te,g as se,h as M,i as le,P as ae,t as re,j as ie,k as F,l as Q,m as ue,n as U,p as s,q as oe,R as T,s as ne,v as ce,x as ve,C as he,y as pe,z as me,A as ye,B as de,D as ge,E as fe,F as He,G as $,H as I,I as Re,J as C,K as je}from"./app-B63-VaOP.js";const ke=["/","/curriculum-vitae/","/info/","/my-projects/Brushless%20motor%20drive%20circuit%20and%20FOC%20control%20algorithm%20design.html","/my-projects/Car%20following%20driving%20system.html","/my-projects/High-throughput%20phenotyping%20system%20for%20potted%20plants.html","/my-projects/Moving%20target%20control%20and%20automatic%20tracking%20system.html","/my-projects/Non-contact%20object%20size%20and%20shape%20measurement.html","/my-projects/","/my-projects/Rolling%20ball%20control%20system.html","/my-projects/Smart%20medicine%20delivery%20car.html","/zh/","/zh/curriculum-vitae/","/zh/my-projects/Brushless%20motor%20drive%20circuit%20and%20FOC%20control%20algorithm%20design.html","/zh/my-projects/Car%20following%20driving%20system.html","/zh/my-projects/High-throughput%20phenotyping%20system%20for%20potted%20plants.html","/zh/my-projects/Moving%20target%20control%20and%20automatic%20tracking%20system.html","/zh/my-projects/Non-contact%20object%20size%20and%20shape%20measurement.html","/zh/my-projects/","/zh/my-projects/Rolling%20ball%20control%20system.html","/zh/my-projects/Smart%20medicine%20delivery%20car.html","/404.html"],we="SEARCH_PRO_QUERY_HISTORY",g=B(we,[]),Qe=()=>{const{queryHistoryCount:l}=C,a=l>0;return{enabled:a,queryHistory:g,addQueryHistory:r=>{a&&(g.value=Array.from(new Set([r,...g.value.slice(0,l-1)])))},removeQueryHistory:r=>{g.value=[...g.value.slice(0,r),...g.value.slice(r+1)]}}},A=l=>ke[l.id]+("anchor"in l?`#${l.anchor}`:""),Ce="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:_}=C,f=B(Ce,[]),qe=()=>{const l=_>0;return{enabled:l,resultHistory:f,addResultHistory:a=>{if(l){const r={link:A(a),display:a.display};"header"in a&&(r.header=a.header),f.value=[r,...f.value.slice(0,_-1)]}},removeResultHistory:a=>{f.value=[...f.value.slice(0,a),...f.value.slice(a+1)]}}},xe=l=>{const a=he(),r=M(),q=pe(),u=F(0),j=Q(()=>u.value>0),m=me([]);return ye(()=>{const{search:y,terminate:x}=de(),H=Re(c=>{const R=c.join(" "),{searchFilter:S=p=>p,splitWord:z,suggestionsFilter:E,...d}=a.value;R?(u.value+=1,y(c.join(" "),r.value,d).then(p=>S(p,R,r.value,q.value)).then(p=>{u.value-=1,m.value=p}).catch(p=>{console.warn(p),u.value-=1,u.value||(m.value=[])})):m.value=[]},C.searchDelay-C.suggestDelay);U([l,r],([c])=>H(c),{immediate:!0}),ge(()=>{x()})}),{isSearching:j,results:m}};var ze=te({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:a}){const r=se(),q=M(),u=le(ae),{enabled:j,addQueryHistory:m,queryHistory:y,removeQueryHistory:x}=Qe(),{enabled:H,resultHistory:c,addResultHistory:R,removeResultHistory:S}=qe(),z=j||H,E=re(l,"queries"),{results:d,isSearching:p}=xe(E),i=ie({isQuery:!0,index:0}),v=F(0),h=F(0),O=Q(()=>z&&(y.value.length>0||c.value.length>0)),b=Q(()=>d.value.length>0),D=Q(()=>d.value[v.value]||null),Y=()=>{const{isQuery:e,index:t}=i;t===0?(i.isQuery=!e,i.index=e?c.value.length-1:y.value.length-1):i.index=t-1},N=()=>{const{isQuery:e,index:t}=i;t===(e?y.value.length-1:c.value.length-1)?(i.isQuery=!e,i.index=0):i.index=t+1},G=()=>{v.value=v.value>0?v.value-1:d.value.length-1,h.value=D.value.contents.length-1},J=()=>{v.value=v.value<d.value.length-1?v.value+1:0,h.value=0},K=()=>{h.value<D.value.contents.length-1?h.value+=1:J()},V=()=>{h.value>0?h.value-=1:G()},L=e=>e.map(t=>je(t)?t:s(t[0],t[1])),W=e=>{if(e.type==="customField"){const t=fe[e.index]||"$content",[o,w=""]=He(t)?t[q.value].split("$content"):t.split("$content");return e.display.map(n=>s("div",L([o,...n,w])))}return e.display.map(t=>s("div",L(t)))},k=()=>{v.value=0,h.value=0,a("updateQuery",""),a("close")},X=()=>j?s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},u.value.queryHistory),y.value.map((e,t)=>s("div",{class:["search-pro-result-item",{active:i.isQuery&&i.index===t}],onClick:()=>{a("updateQuery",e)}},[s($,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},e),s("button",{class:"search-pro-remove-icon",innerHTML:I,onClick:o=>{o.preventDefault(),o.stopPropagation(),x(t)}})]))])):null,Z=()=>H?s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},u.value.resultHistory),c.value.map((e,t)=>s(T,{to:e.link,class:["search-pro-result-item",{active:!i.isQuery&&i.index===t}],onClick:()=>{k()}},()=>[s($,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[e.header?s("div",{class:"content-header"},e.header):null,s("div",e.display.map(o=>L(o)).flat())]),s("button",{class:"search-pro-remove-icon",innerHTML:I,onClick:o=>{o.preventDefault(),o.stopPropagation(),S(t)}})]))])):null;return ue("keydown",e=>{if(l.isFocusing){if(b.value){if(e.key==="ArrowUp")V();else if(e.key==="ArrowDown")K();else if(e.key==="Enter"){const t=D.value.contents[h.value];m(l.queries.join(" ")),R(t),r.push(A(t)),k()}}else if(H){if(e.key==="ArrowUp")Y();else if(e.key==="ArrowDown")N();else if(e.key==="Enter"){const{index:t}=i;i.isQuery?(a("updateQuery",y.value[t]),e.preventDefault()):(r.push(c.value[t].link),k())}}}}),U([v,h],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>s("div",{class:["search-pro-result-wrapper",{empty:l.queries.length?!b.value:!O.value}],id:"search-pro-results"},l.queries.length?p.value?s(oe,{hint:u.value.searching}):b.value?s("ul",{class:"search-pro-result-list"},d.value.map(({title:e,contents:t},o)=>{const w=v.value===o;return s("li",{class:["search-pro-result-list-item",{active:w}]},[s("div",{class:"search-pro-result-title"},e||u.value.defaultTitle),t.map((n,ee)=>{const P=w&&h.value===ee;return s(T,{to:A(n),class:["search-pro-result-item",{active:P,"aria-selected":P}],onClick:()=>{m(l.queries.join(" ")),R(n),k()}},()=>[n.type==="text"?null:s(n.type==="title"?ne:n.type==="heading"?ce:ve,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[n.type==="text"&&n.header?s("div",{class:"content-header"},n.header):null,s("div",W(n))])])})])})):u.value.emptyResult:z?O.value?[X(),Z()]:u.value.emptyHistory:u.value.emptyResult)}});export{ze as default};
